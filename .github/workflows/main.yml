name: Build Modpack

on:
  push:
    branches:
      - build-dev
  workflow_dispatch:

jobs:
  Build-Modpack:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
          
      - run: git config user.email "${{ github.actor }}@users.noreply.github.com"
        if: ${{ github.repository_owner != 'github-actions' }}

      - run: git config user.name "${{ github.actor }}"
        if: ${{ github.repository_owner != 'github-actions' }}
        
  
   
      - name: Build Modpack
        run: |
          rm -rf .github
          rm -rf .git
          rm README.md
          cd /home/runner/work/Tiao-s-Modpack-For-Tiao-s-Server/Tiao-s-Modpack-For-Tiao-s-Server/
          zip -r /home/runner/work/Tiao-s-Modpack-For-Tiao-s-Server/Tiao-s-Modpack-For-Tiao-s-Server/v1.17.1-0.7.x-testpack-lite.mrpack ./*
      
      - uses: actions/upload-artifact@v2
        with:
          name: v1.17.1-0.7.x-testpack-lite.mrpack
          path: /home/runner/work/Tiao-s-Modpack-For-Tiao-s-Server/Tiao-s-Modpack-For-Tiao-s-Server/v1.17.1-0.7.x-testpack-lite.mrpack

  Test-Modpack:
     runs-on: windows-10
     needs: Build-Modpack
     steps:
       - uses: actions/download-artifact@v2
         with:
           name: v1.17.1-0.7.x-testpack-lite.mrpack

       - name: Install Java
         uses: actions/setup-java@v2
         with:
          java-version: '17'
          distribution: 'Liberica'

       - name: Test Modpack
         run: |
           powershell wget https://gitee.com/MrShiehX/console-minecraft-launcher/releases/download/2.1.3/cmcl.exe
           cmcl.exe modpack --file=v1.17.1-0.7.x-testpack-lite.mrpack
           test
           cmcl.exe account --login=offline --name=TEST -s
           cmcl.exe test

